!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__error",errorClass:"modal__input_state_error"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.errorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},o=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error ${e.status}`))}editUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(e=>e.ok?e.json():Promise.reject(`Error ${e.status}`))}editAvatarPicture(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(e=>e.ok?e.json():Promise.reject(`Error ${e.status}`))}addUserCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}deleteUserCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"2ff931b6-b90a-4804-a7ca-5d064113fca0","Content-Type":"application/json"}}),a=document.querySelector(".profile__edit-btn"),s=document.querySelector("#edit-profile-modal"),c=s.querySelector(".modal__close-btn"),i=s.querySelector(".modal__form"),l=s.querySelector("#profile-name-input"),d=s.querySelector("#profile-description-input"),u=s.querySelector(".modal__submit-btn");a.addEventListener("click",function(){l.value=N.textContent,d.value=O.textContent,((e,r,n)=>{r.forEach(r=>{t(e,r,n)})})(s,[l,d],e),M(s)}),c.addEventListener("click",function(){F(s)}),i.addEventListener("submit",function(e){e.preventDefault(),u.textContent="Saving...",o.editUserInfo({name:l.value,about:d.value}).then(e=>{N.textContent=e.name,O.textContent=e.about,F(s)}).catch(console.error).finally(()=>{u.textContent="Save"})});const m=document.querySelector(".profile__avatar-btn"),_=document.querySelector("#edit-avatar-modal"),h=document.querySelector(".profile__avatar"),f=_.querySelector(".modal__close-btn"),v=_.querySelector(".modal__form"),y=_.querySelector("#profile-avatar-input"),S=_.querySelector(".modal__submit-btn");m.addEventListener("click",function(){M(_)}),f.addEventListener("click",function(){F(_)}),v.addEventListener("submit",function(e){e.preventDefault(),S.textContent="Saving...",o.editAvatarPicture({avatar:y.value}).then(e=>{h.src=e.avatar,F(_),v.reset()}).catch(console.error).finally(()=>{S.textContent="Save"})});const b=document.querySelector(".profile__add-btn"),p=document.querySelector("#new-post-modal"),q=p.querySelector(".modal__close-btn"),E=p.querySelector(".modal__form"),k=p.querySelector("#card-image-input"),C=p.querySelector("#card-caption-input"),L=p.querySelector(".modal__submit-btn");b.addEventListener("click",function(){M(p)}),q.addEventListener("click",function(){F(p)}),E.addEventListener("submit",function(t){t.preventDefault(),L.textContent="Saving...",o.addUserCard({name:C.value,link:k.value}).then(r=>{const o=B(r);T.prepend(o),F(p),E.reset(),n(t.submitter,e)}).catch(console.error).finally(()=>{L.textContent="Save"})});const $=document.querySelector("#delete-picture-modal"),U=$.querySelector(".modal__delete-close-btn"),g=$.querySelector(".modal__delete-btn"),x=$.querySelector(".modal__cancel-btn");function j(e,t){g.textContent="Deleting...",o.deleteUserCard(H).then(()=>{J.remove(),F($)}).catch(console.error).finally(()=>{g.textContent="Delete"})}$.addEventListener("submit",j),g.addEventListener("click",function(){j()}),U.addEventListener("click",function(){F($)}),x.addEventListener("click",function(){F($)});const P=document.querySelector("#preview-post-modal"),A=P.querySelector(".modal__image"),I=P.querySelector(".modal__close_type_preview"),w=P.querySelector(".modal__preview-title");I.addEventListener("click",function(){F(P)});const D=document.querySelector("#card-template").content.querySelector(".card"),T=document.querySelector(".cards__list");function B(e){const t=D.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),a=t.querySelector(".card__like-btn"),s=t.querySelector(".card__delete-btn");return a.addEventListener("click",function(){!function(e,t){e.classList.contains("card__like-btn-active")?o.removeLike(t).then(()=>{e.classList.remove("card__like-btn-active")}):o.likeCard(t).then(()=>{e.classList.add("card__like-btn-active")}).catch(console.error)}(a,e._id)}),s.addEventListener("click",function(){J=t,H=e._id,M($)}),n.addEventListener("click",function(){A.src=e.link,A.alt=e.name,w.textContent=e.name,M(P)}),n.src=e.link,n.alt=e.name,r.textContent=e.name,t}const N=document.querySelector(".profile__name"),O=document.querySelector(".profile__description");let J,H;function z(e){"Escape"===e.key&&F(document.querySelector(".modal_is-opened"))}function M(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",z)}function F(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",z)}document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&F(e)})}),(e=>{document.querySelectorAll(e.formSelector).forEach(n=>{((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach(s=>{s.addEventListener("input",function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.errorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)})})})(n,e)})})(e),o.getAppInfo().then(([e,t])=>{e.forEach(function(e){const t=B(e);T.append(t)}),N.textContent=t.name,O.textContent=t.about,h.src=t.avatar}).catch(console.error)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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N0gsRUFBUVIsTUNnUjlCNEksQ0FBaUI1SSxHQUVqQjBCLEVBQ0dPLGFBQ0FNLEtBQUssRUFBRXNHLEVBQU9DLE1BQ2JELEVBQU1sRSxRQUFRLFNBQVVvRSxHQUN0QixNQUFNM0MsRUFBY0MsRUFBZTBDLEdBQ25DekMsRUFBVTBDLE9BQU81QyxFQUNuQixHQUVBNUIsRUFBYzVELFlBQWNrSSxFQUFTM0YsS0FDckNzQixFQUFxQjdELFlBQWNrSSxFQUFTMUYsTUFDNUNpQyxFQUFjSyxJQUFNb0QsRUFBU3hGLFNBRTlCMEIsTUFBTUMsUUFBUUMsTSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF9zdGF0ZV9lcnJvclwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1zZywgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5lcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWwsIGNvbmZpZyk7XG4gIH0pO1xufTtcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5cbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIGNvbmZpZyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xuLy8gICB7XG4vLyAgICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnRyd2FyZS1lbmdpbmVlci9zcG90cy8yLXBob3RvLWJ5LWNlaWxpbmUtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkFuIG91dGRvb3IgY2FmZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8zLXBob3RvLWJ5LXR1YmFudXItZG9nYW4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkEgdmVyeSBsb25nIGJyaWRnZSwgb3ZlciB0aGUgZm9yZXN0IGFuZCB0aHJvdWdoIHRoZSB0cmVlc1wiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy80LXBob3RvLWJ5LW1hdXJpY2UtbGFzY2hldC1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiVHVubmVsIHdpdGggbW9ybmluZyBsaWdodFwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy81LXBob3RvLWJ5LXZhbi1hbmgtbmd1eWVuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJNb3VudGFpbiBob3VzZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy82LXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vIF07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFQSSBTRVRVUFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCIyZmY5MzFiNi1iOTBhLTQ4MDQtYTdjYS01ZDA2NDExM2ZjYTBcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFRElUIFBST0ZJTEUgTU9EQUxcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVDbG9zZUJ0biA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb24gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlU3VibWl0QnRuID1cbiAgZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGVkaXRQcm9maWxlU3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcblxuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IGVkaXRQcm9maWxlTmFtZS52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0UHJvZmlsZURlc2NyaXB0aW9uLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgZWRpdFByb2ZpbGVTdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcbiAgICB9KTtcbn1cblxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgZWRpdFByb2ZpbGVOYW1lLnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudDtcbiAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbi52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oXG4gICAgZWRpdFByb2ZpbGVNb2RhbCxcbiAgICBbZWRpdFByb2ZpbGVOYW1lLCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uXSxcbiAgICBjb25maWdcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5lZGl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdCk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFWQVRBUiBNT0RBTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBlZGl0QXZhdGFyUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcbmNvbnN0IGF2YXRhclBpY3R1cmVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJQcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBhdmF0YXJQaWN0dXJlQ2xvc2VCdG4gPVxuICBhdmF0YXJQaWN0dXJlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgYXZhdGFyUGljdHVyZUZvcm0gPSBhdmF0YXJQaWN0dXJlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhclBpY3R1cmVMaW5rID0gYXZhdGFyUGljdHVyZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCJcbik7XG5jb25zdCBhdmF0YXJQaWN0dXJlU3VibWl0QnRuID1cbiAgYXZhdGFyUGljdHVyZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclBpY3R1cmVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGF2YXRhclBpY3R1cmVTdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuXG4gIGFwaVxuICAgIC5lZGl0QXZhdGFyUGljdHVyZSh7XG4gICAgICBhdmF0YXI6IGF2YXRhclBpY3R1cmVMaW5rLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGF2YXRhclByb2ZpbGUuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhclBpY3R1cmVNb2RhbCk7XG4gICAgICBhdmF0YXJQaWN0dXJlRm9ybS5yZXNldCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgYXZhdGFyUGljdHVyZVN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH0pO1xufVxuXG5lZGl0QXZhdGFyUGljdHVyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuTW9kYWwoYXZhdGFyUGljdHVyZU1vZGFsKTtcbn0pO1xuXG5hdmF0YXJQaWN0dXJlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChhdmF0YXJQaWN0dXJlTW9kYWwpO1xufSk7XG5cbmF2YXRhclBpY3R1cmVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyUGljdHVyZVN1Ym1pdCk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE5FVyBQT1NUIE1PREFMXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IG5ld1Bvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdENsb3NlQnRuID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RGb3JtID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBuZXdQb3N0TGluayA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0RGVzY3JpcHRpb24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWNhcHRpb24taW5wdXRcIik7XG5jb25zdCBuZXdQb3N0U3VibWl0QnRuID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5cbmZ1bmN0aW9uIGhhbmRsZU5ld1Bvc3RTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBuZXdQb3N0U3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcblxuICBhcGlcbiAgICAuYWRkVXNlckNhcmQoe1xuICAgICAgbmFtZTogbmV3UG9zdERlc2NyaXB0aW9uLnZhbHVlLFxuICAgICAgbGluazogbmV3UG9zdExpbmsudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoY2FyZERhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICAgICAgbmV3UG9zdEZvcm0ucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oZXZ0LnN1Ym1pdHRlciwgY29uZmlnKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIG5ld1Bvc3RTdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcbiAgICB9KTtcbn1cblxubmV3UG9zdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlTmV3UG9zdFN1Ym1pdCk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERFTEVURSBNT0RBTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLXBpY3R1cmUtbW9kYWxcIik7XG5jb25zdCBkZWxldGVDbG9zZUJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2RlbGV0ZS1jbG9zZS1idG5cIik7XG5jb25zdCBkZWxldGVNb2RhbEJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2RlbGV0ZS1idG5cIik7XG5jb25zdCBkZWxldGVDYW5jZWxCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYW5jZWwtYnRuXCIpO1xuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRJZCwgZXZ0KSB7XG4gIGRlbGV0ZU1vZGFsQnRuLnRleHRDb250ZW50ID0gXCJEZWxldGluZy4uLlwiO1xuXG4gIGFwaVxuICAgIC5kZWxldGVVc2VyQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGRlbGV0ZU1vZGFsQnRuLnRleHRDb250ZW50ID0gXCJEZWxldGVcIjtcbiAgICB9KTtcbn1cblxuZGVsZXRlTW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVDYXJkKTtcblxuZGVsZXRlTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgaGFuZGxlRGVsZXRlQ2FyZCgpO1xufSk7XG5cbmRlbGV0ZUNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmRlbGV0ZUNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQUkVWSUVXIE1PREFMXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0ltYWdlID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld0Nsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZV90eXBlX3ByZXZpZXdcIlxuKTtcbmNvbnN0IHByZXZpZXdUaXRsZSA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19wcmV2aWV3LXRpdGxlXCIpO1xuXG5wcmV2aWV3Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENBUkQgRlVOQ1RJT05TXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIilcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IGNhcmRUaXRsZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG5cbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBoYW5kbGVMaWtlQ2FyZChjYXJkTGlrZUJ0biwgZGF0YS5faWQpO1xuICB9KTtcblxuICBjYXJkRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcblxuICAgIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG4gIH0pO1xuXG4gIGNhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgcHJldmlld0ltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuICAgIHByZXZpZXdUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElUWSBGVU5DVElPTlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3QgcHJvZmlsZU5hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcblxuY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcblxuLy9WYXJpYWJsZXMgZm9yIGRlbGV0ZSBmdW5jdGlvbmFsaXR5XG5sZXQgc2VsZWN0ZWRDYXJkO1xubGV0IHNlbGVjdGVkQ2FyZElkO1xuXG5mdW5jdGlvbiBoYW5kbGVMaWtlQ2FyZChjYXJkTGlrZUJ0biwgY2FyZElkKSB7XG4gIGNvbnN0IGlzTGlrZWQgPSBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bi1hY3RpdmVcIik7XG5cbiAgaWYgKGlzTGlrZWQpIHtcbiAgICBhcGkucmVtb3ZlTGlrZShjYXJkSWQpLnRoZW4oKCkgPT4ge1xuICAgICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnRuLWFjdGl2ZVwiKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhcGlcbiAgICAgIC5saWtlQ2FyZChjYXJkSWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bi1hY3RpdmVcIik7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVzY2FwZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuZWRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGUpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5cbm1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgIGlmIChldnQudGFyZ2V0ID09PSBtb2RhbCkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJTklUSUFMSVpBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5lbmFibGVWYWxpZGF0aW9uKGNvbmZpZyk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJJbmZvXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcblxuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlckluZm8uYWJvdXQ7XG4gICAgYXZhdGFyUHJvZmlsZS5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiIsIi8vIGltcG9ydCB7IGRhdGEgfSBmcm9tIFwiYXV0b3ByZWZpeGVyXCI7XG5cbmNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3IgJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKGRhdGEpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgYWJvdXQ6IGRhdGEuYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJQaWN0dXJlKGRhdGEpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXI6IGRhdGEuYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvciAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBhZGRVc2VyQ2FyZChkYXRhKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgbGluazogZGF0YS5saW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlVXNlckNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlTGlrZShjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWwiLCJpbnB1dEVsIiwicXVlcnlTZWxlY3RvciIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsImFwaSIsImNvbnN0cnVjdG9yIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJlZGl0VXNlckluZm8iLCJkYXRhIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJuYW1lIiwiYWJvdXQiLCJlZGl0QXZhdGFyUGljdHVyZSIsImF2YXRhciIsImFkZFVzZXJDYXJkIiwibGluayIsImRlbGV0ZVVzZXJDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJyZW1vdmVMaWtlIiwiYXV0aG9yaXphdGlvbiIsImVkaXRQcm9maWxlQnRuIiwiZG9jdW1lbnQiLCJlZGl0UHJvZmlsZU1vZGFsIiwiZWRpdFByb2ZpbGVDbG9zZUJ0biIsImVkaXRQcm9maWxlRm9ybSIsImVkaXRQcm9maWxlTmFtZSIsImVkaXRQcm9maWxlRGVzY3JpcHRpb24iLCJlZGl0UHJvZmlsZVN1Ym1pdEJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJ2YWx1ZSIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsInJlc2V0VmFsaWRhdGlvbiIsImZvckVhY2giLCJvcGVuTW9kYWwiLCJjbG9zZU1vZGFsIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsImZpbmFsbHkiLCJhdmF0YXJQaWN0dXJlTW9kYWwiLCJhdmF0YXJQcm9maWxlIiwiYXZhdGFyUGljdHVyZUNsb3NlQnRuIiwiYXZhdGFyUGljdHVyZUZvcm0iLCJhdmF0YXJQaWN0dXJlTGluayIsImF2YXRhclBpY3R1cmVTdWJtaXRCdG4iLCJzcmMiLCJyZXNldCIsIm5ld1Bvc3RCdG4iLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0Q2xvc2VCdG4iLCJuZXdQb3N0Rm9ybSIsIm5ld1Bvc3RMaW5rIiwibmV3UG9zdERlc2NyaXB0aW9uIiwibmV3UG9zdFN1Ym1pdEJ0biIsImNhcmREYXRhIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsInByZXBlbmQiLCJzdWJtaXR0ZXIiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUNsb3NlQnRuIiwiZGVsZXRlTW9kYWxCdG4iLCJkZWxldGVDYW5jZWxCdG4iLCJoYW5kbGVEZWxldGVDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJzZWxlY3RlZENhcmQiLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3SW1hZ2UiLCJwcmV2aWV3Q2xvc2VCdG4iLCJwcmV2aWV3VGl0bGUiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlRWwiLCJjYXJkSW1hZ2VFbCIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsImNvbnRhaW5zIiwiaGFuZGxlTGlrZUNhcmQiLCJfaWQiLCJhbHQiLCJoYW5kbGVFc2NhcGUiLCJrZXkiLCJtb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJxdWVyeVNlbGVjdG9yQWxsIiwidGFyZ2V0Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTXNnIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlbmFibGVWYWxpZGF0aW9uIiwiY2FyZHMiLCJ1c2VySW5mbyIsIml0ZW0iLCJhcHBlbmQiXSwic291cmNlUm9vdCI6IiJ9